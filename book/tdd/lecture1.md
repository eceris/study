# 테스트 주도 개발

TDD : `개발자가 자신을 위해 처음으로 수행하는 테스트` 인데, 그래서 흔히 개발자 테스트(programmer test)라고 부르기도 함.

## 테스트 주도 개발의 진행 방식
```
- 질문(Ask) : 테스트 작성을 통해 시스템에 질문한다. (테스트 수행 결과는 실패)
- 응답(Respond): 테스트를 통과하는 코드를 작성해서 질문에 대답한다. (테스트성공)
- 정제(Refine): 아이디어를 통합하고, 불필요한 것은 제거하고, 모호한 것은 명확히 해서 대답을 정제한다. (리팩토링)
- 반복(Repeat): 다음 질문을 통해 대화를 계속 진행한다.

```

TDD를 이용한 개발은 크게 ‘질문 → 응답 → 정제’라는 세 단계가 반복적으로 이루어짐.

### 작성하고자 하는 메소드나 기능이 무엇인지 선별하고 작성 완료 조건을 정해서 실패하는 테스트 케이스를 작성하는 것

1. 일단은 아래와 같이 테스트 코드를 작성한다. 이런 식으로 진행하는 이유는 테스트 케이스 작성 시 흐름을 잃지 않기 위해
```java
public void testAccount() {
	Account account = new Account();
	if (account == null) {
		throw new Exception("계좌생성 실패")
	}
}

public static void main(String [] args) {
	AccountTest test = new AccountTest();
	test.testAccount(); // 테스트 케이스 실행
}
```
2. 컴파일이 안된다. 왜냐면, 구현체가 없기 때문인데, 위와 같은 과정을 `질문`이라는 단계로 한다. 
3. 그럼 이제 `응답`단계로 넘어가서, 시스템의 `Error`에 응답 하자.
4. Account 코드를 구현하자.
```java
public class Account {
}
```
5. 이제 `정제` 단계인데, 위와 같이 구현된 코드를 리팩토링하는 단계다. 일반적으로 아래와 같은 질문에 대해 고민해보는 시간을 갖는다. 
- 소스의 가독성이 적절한가?
- 중복된 코드는 없는가?
- 이름이 잘못 부여된 메소드나 변수명은 없는가?
- 구조의 개선이 필요한 부분은 없는가?


**fail()** 메소드는 JUnit에서 제공하는 메소드인데, 호출되면 해당 테스트 케이스는 그 순간 무조건 실패.

### 테스트 케이스가 가치를 지니기 위해서는, 어떠한 경우에도 테스트 케이스 그 자체는 정상적으로 끝까지 수행돼야 한다.

- 테스트 케이스를 엉성하게 만들면 테스트 자체를 신뢰할 수 없게 된다.
- 테스트 케이스를 통한 제품 코드 구현을 하드코딩으로 시작하는 것도 괜찮은 출발점.


앞서 작성한 하드코딩 값, 혹은 **엉성하게 작성한 로직**이 작성된 테스트 케이스를 모두 통과한다면, 찜찜하
고 허탈할 수 있지만 그 로직이 현재 가장 유력한 정답이 된다. 
비록 **코드가 어설프고** **if/else**로 점철되어 있다 하더라도, 작성된 **테스트 케이스**를 전부 통과했다면 우선은 다음 단계로 진행.


TDD에서 중요한 건 `목표 이미지를 미리 세운다` → `자동화된 테스트 케이스를 작성한다` → `만족시키는 로직을 작성하고 정련한다` 인 거지 JUnit을 사용한다던가 assertEquals를 사용한다 가 아니다.

그리고 보통 테스트에 사용할 자원이나 객체들을 준비해놓는 부분을 **픽스처**<sup>fixture, 지지대</sup>라고 부른다. 대부분의 테스트 프레임워크는 픽스처를 지원하고 있다. JUnit에서는 **Before**와 **After**라는 개념으로 준비와 정리 작업에 해당하는 처리 방법을 제공한다.

### TDD의 장점 
#### 1. 개발의 방향을 잃지 않게 유지해준다.
**현재** 어떤 기능을 개발하고, 어디까지 와있는지를 항상 살펴볼 수 있다. 남은 단계를 잊지 않게 도와준다. 
일부 개발자는 개발 도중 자리를 비우게 될때, 작성하는 테스트 케이스를 일부러 실패하도록 만들어 놓기도 한다. 다음에 자리로 왔을때 재시작점을 바로 알 수 있도록 하기 위해.

#### 2. 품질 높은 소프트웨어 모듈 보유
NASA에서 우주선을 만들때도, 부품 조립을 하고 테스트를 하는 것이 아니라, 테스트에 통과한 제품들만 조립에 이용된다. **단위 모듈의 중요성**은 강조할만 하다. 

#### 3. 자동화된 단위 테스트 케이스를 갖게 된다.
TDD 의 부산물로 나오는 자동화된 단위 테스트 케이스들은 언제든지 필요한 시점에 수행해볼수 있다. 엄청난 동체 시력을 가진 개발자들을 부러워 하지 않아도 된다.

#### 4. 사용설명서 & 의사소통 수단
TDD를 통해 작성된 테스트 케이스는 **사용 설명서**이자, 그와 동시에 다른 개발자와 소통하는 **커뮤니케이션 통로**가 된다.

#### 5. 설계 개선
테스트 케이스 작성 시에는 클래스나 인터페이스, 접근제어자(access modifier), 이름 짓기(naming), 인자(argument) 등에 이르는 개발에 포함된 다양한 설계 요소들에 대해 미리부터 고민하게 된다.

#### 6. 보다 자주 성공한다.
기본적으로, TDD는 매 주기(cycle)를 짧게 설정하도록 권장한다.


### [엉클밥의 TDD 원칙](http://www.infoq.com/interviews/coplien-martin-tdd)
➊ 실패하는 테스트를 작성하기 전에는 절대로 제품 코드를 작성하지 않는다.
➋ 실패하는 테스트 코드를 한 번에 하나 이상 작성하지 않는다.
➌ 현재 실패하고 있는 테스트를 통과하기에 충분한 정도를 넘어서는 제품 코드를 작성하지 않는다.