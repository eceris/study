# TDD에 대한 다양한 시각

## TDD와 소프트웨어 디자인
TDD는 어떤 **설계 상의 이점**을 줄 수 있을까? TDD로 개발을 하면 TDD 자체가 단위 단위의 **작은 설계**를 만들어낸다.

### TDD와 객체지향 프로그래밍

OOP가 강조되는 이유는 `안전한 부품` 그리고 `재사용성`을 높여주는 요소를 더 쉽게 만들 수 있기 때문.

의존관계가 많은 코드는 테스트 코드 자체를 만들기가 어렵다.

#### 유연한 코드
**유연한 코드**란 변화에 **쉽게 적응**할 수 있는 코드를 말한다. 하지만 유연함은 때로 `개발비용 증가` 의 요소가 되기도 하는데, 레고 조각을 제공하고 ~~어떤 모양의 자동차도 만들수 있다~~ 라는 것과 비슷하다.

**현재 필요한 기능에만 최대한 집중**하는게 여기서 말하는 조금의 노력이고 적절한 선택이다.

 - 시스템에 익숙하지 않은 사람이 **새로운 요구사항 반영**을 위해 소프트웨어에 변경을 가하는 데 소요되는 시간

위의 시간을 측정하는 것이 **적절히 유연한 코드**인지를 **판단하는 기준**으로 좀 더 유용하다.

#### TDD의 리듬을 이렇게 유지하는걸 추천한다.

1. 시간을 들여서라도 테스트 코드를 문맥에 맞게 잘 짠다.
2. 코드가 더럽더라도 최대한 빠르게 테스트 코드를 통과하는 비즈니스/로직 코드를 작성한다. (매우 중요!!)
3. 리팩터링을 한다.(2번 만큼이나 역시 매우 중요!!!)


## TDD 유의 사항
#### 테스트 케이스는 이름이 중요하다.
- 테스트 메소드의 이름이 좀 길어지더라도 해당 테스트가 **무엇**이고 실패한 **세부 항목**이 무엇인지 곧바로 알 수 있어야 한다.
예를 들면 
```
- testWithdraw_마이너스통장_대출한계이상으로_인출요구시( )
- testWithdraw_마이너스통장_연체이자미납자_인출요구시( )
```

#### 더 이상 제대로 동작하지 않는 테스트 케이스는 제거한다.
- 자동화된 테스트 메소드는 소스의 품질을 좌우하는 중요한 자산. 
- 동작하지 않는 테스트 케이스는 과감하게 제거할 것.

#### TDD는 자동화된 테스트를 만드는 것이 최종 목표가 아니다.
- 자동화된 단위 테스트 케이스들은 TDD의 부산물이다. 개발과 설계를 위한 보조 도구이지 목적은 아니다.

#### 모든 상황에 대한 테스트 케이스를 만들 필요는 없다.
- 요구 사항에 맞는 현재 필요한 기능에 대한 테스트만 만든다. `TDD는 힘들고 어렵고 복잡하구나` 라고 혼자 지치지말고 지나치게 집착하지 말라는 소리다.

#### 여러 개의 실패하는 테스트 케이스를 한 번에 만들지 않는다.
- 개발중에는, 작성하고 있는 클래스에 대해 하나의 실패하는 테스트만 유지한다. 해당 실패를 성공시킨 다음에 실패하는 케이스를 작성한다.

#### 하나의 테스트 케이스는 하나만 테스트하도록 작성한다.
- 이걸 강조하는 사람 중 어떤 사람은 assert 단정문도 딱 한번만 쓰자고 말한다. 그렇게 하진 못하더라도 여러 항목을 하나의 테스트 케이스에서 하는 것은 좋지 않다.

#### 전통적인 테스트 기법을 배워두자.
- 각종 테스트 기법을 알면 좀 더 다양한 환경에서 효율적인 테스트 클래스 작성이 가능하다. 마스터가 될 필요는 없지만, 그래도 다다익선!

#### 테스트 케이스는 최대한 고립시킨다.
- 각각의 단위 테스트는 다른 모듈이나 시스템에 최대한 독립적이고 고립된 형태로 작성될수록 단단한 테스트케이스가 된다.


## TDD와 리팩토링
TDD는 잘 동작하는 **깔끔한 코드**를 목표로 한다. 소스가 작성되는 시점에 함께 만들 수 있으면 금상첨화다.<sup>코드를 작성한 후에 테스트 케이스를 작성한다면, 이정도면 충분해... 라는 자기합리화가 쉽게 된다.</sup>
**나타내고자 하는 의미를 좀 더 명확**하게 하는 것, 그것이 리팩토링의 기본이다. 


## TDD와 짝 프로그래밍
TDD는 설계를 위한 기법이고 작업을 해나가려면 때때로 많은 전략과 사고가 필요. 두 사람의 머리가 더 나은 답을 찾을 확률이 높다. 특히 프로젝트 초반일수록 얻게 되는 이점이 더욱더 크다.

## 행위 주도 개발
`TDD를 어디에서부터 시작할 것인가`, `테스트는 어느정도 작성해야 할 것인가` 와 같은 TDD의 시작점과 범위에 대한 문제의 해결을 도와주는 방식으로 **행위 주도 개발**<sup>Behavior-Driven Development, BDD</sup>이 있다.


### BDD의 정의와 목표
- BDD는 **책임관계자**<sup>stake holder</sup> 의 관점에서 보는 애플리케이션의 행위, 동작 중 가치있는 기능 부터 개발하는 방식
- 애플리케이션의 로직 중에서도 특히 **업무규칙**과 관련된 부분을 노출시키는데 집중.
- 프로젝트에 참여하는 인원들의 **협업을 증진**시키는 것을 **목표**로 만들어짐.

### BDD의 특징
BDD는 세가지 측면에서 TDD와 차이점이 있다.

#### 1. BDD는 고객에 좀 더 가까운 고수준의 기능영역을 우선적으로 다룬다.
- 테스트 코드가 정상적으로 작동한다는 것에는 관심이 없다. 실제로 고객이 요구한 것이 동작하는 것을 보고 싶어 한다.

#### 2. 무엇을 테스트 할 것인가? 에 좀더 초점을 맞추고 있다.
- `현재 시스템에 들어 있지 않은 기능 중 가장 먼저 구현돼야 하는 기능은 무엇인가?` 가 가장 중요한 질문이다.
- TDD와는 다르게 **사용자에게 가까운 부분에서 안쪽 모듈**을 향해 개발을 진행해나가므로 BDD를 **아웃사이드-인**<sup>outside-in</sup> 개발 방식으로 부른다.

#### 3. 테스트 메소드 작성에 집중할 수 있는 문장적인 템플릿을 제공
BDD의 기본 템플릿

| 이름 | 설명 |
|:--------|:--------|
| Given | 주어진 상황이나 조건 |
| When | 기능 수행 |
| Then | 예상 결과 |

조건과 동작, 그리고 결과를 구분지어 생각하도록 유도하는 방식은, 그것도 자연어 문장으로 만들어지는 템플릿은 assertEquals보다는 훨씬 편안함을 준다.
```java
public void shouldWithdrawMoney() {
	...
}
```
TDD는 test라는 이름으로 메소드가 시작하지만, 행위 기준으로 보면 **예상하는 행동**을 하는지<sup>should do something</sup> 위주로 작성.

### BDD 접근 전략
BDD 와 TDD 중 하나를 꼭 선택해야 하는 건 아니다. 개발자는 TDD가 좋고, 고객관점에서 얘기하거나 대상 시스템의 최종 형태를 파악하며 개발해야할때는, BDD를 우선적으로 사용.

### BDD 와 TDD

| BDD | TDD |
|:--------|:--------|
| 사용자 시나리오를 통해 사용자 테스트와 회귀 테스트를 지향 | 예제에 의한 개발과 단위 테스트를 지향 |
| 최종 목표를 미리 명확하게 해서, 모듈이 산재되는 것을 막음 | TDD는 자칫 모듈이 얇고 가볍게 만들어져 산만하게 흩어질 수 있음. |

### BDD 정리
BDD는 TDD에서 사용되는 일종의 개발 전략이고 어떤 면에서는 **발전형**이다. BDD와 TDD는 사용하는 어휘와 **목적이 조금 다를 뿐, 목표는 같다.**
