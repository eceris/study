# 디스틸레이션
`디스틸레이션`은 **혼합된 요소**를 **분리**해서 **본질**을 좀더 값지고 유용한 형태로 뽑아내는 과정이다.
![전략적 디스틸레이션에 대한 네비게이션 맵](15-distillation.png)

## CORE DOMAIN
규모가 큰 시스템을 설계할 때는 시스템에 기여하는 구성요소가 무수히 많은데, 모두 복잡하고 성공에 절대적이어서 진정한 업무 자산에 해당하는 도메인의 본질적인 측면이 가려지거나 방치될 수 있다. 

어떤 행위가 다른 곳에 이미 존재한다는 사실을 개발자가 알지 못하면 중복이 일어나고 시스템이 훨씬 복잡해진다. 현실은 설계의 모든 부분이 동일하게 정제되지 않고, 고급 기술을 가진 개발자가 기술적인 인프라스트럭처나 특별한 도메인 지식 없이도 다룰 수 있는 명료한 문제만 다루려고 한다는 것. 또한 보통은, 핵심부분은 숙련도가 낮은 개발자가 개발하더라.

> CORE DOMAIN을 찾아서 그것을 지원하는 여러 모델과 코드로부터 쉽게 구별할 수 있도록 하자. 가장 가치있고 전문화된 개념을 부각시키는 CORE를 아주 작게 만들자.
시스템의 비전을 수행하기 에 충분한 심층 모델을 찾고 유연한 설계를 할 수 있도록 CORE에 모든 노력을 쏟아라.

시간 제약 상 두가지 수행할 필요가 있는 리팩토링 가운데 어느 것을 결정해야 할 지 모를 때에는 CORE DOMAIN에 가장 큰 영향을 줄 수 있는 것을 먼저 선택해야한다.

### CORE의 선택
도메인에 대한 통찰력이 경험에 의해 깊어지면 일반화된 개념이 분리되고 오로지 모델의 특화된 측면만 CORE DOMAIN에 유지 되어 디스틸리에션 프로세스가 계속될 수 있다.
어떤 어플리케이션에서는 CORE DOMAIN인데, 다른 어플리케이션에서는 일반화된 보조 컴포넌트일 수도 있다.

### 누가 그 일을 할 것인가?
도메인 지식을 보조 컴포넌트처럼 인식하는 경향이 심화되며, 지식의 부족으로 프로젝트 구성원들이 도메인 지식을 축적할 기회를 얻지 못한다. 
> 오랜기간 팀에 참여하고 도메인 지식의 대장이 되는 데에 관심이 있는 개발자와 업무를 깊이 알고 있는 도메인 전문가로 팀을 구성.

### 디스틸레이션의 단계적 확대

1. 간단한 DOMAIN VISION STATEMENT(비전선언문)는 최소한의 투자로 기본 개념과 가치를 전달
2. HIGHLIGHTED CORE(강조된 핵심) 는 의사소통을 향상시키고 의사결정을 내리는 데 도움이 된다.(설계의 수정이 최소한이다.)
3. 좀더 적극적인 리팩터링과 재패키지화를 거쳐 명확하게 GENERIC SUBDOMAIN(일반화된 서브도메인) 을 구분하여 개별적으로 다룰 수 있다.
4. COHESIVE MECHANISM(응집된 메커니즘) 은 용도가 다양하고 의미전달이 용이, 유연한 설계를 통해 캡슐화 할수 있다.
5. SEGREGATED CORE(분리된 핵심) 를 재패키지화 하면 CORE를 코드상에서도 바로 볼수 있게 되고, CORE 모델에 대한 향후 업무가 쉬워진다.
6. ABSRACT CORE(추상화된 핵심) 는 가장 근본적인 개념과 관계를 순수한 형태로 표현(그리고 모델을 대상으로광범위한 재구성과 리팩터링이 필요)


## GENERIC SUBDOMAIN(일반 하위 도메인)
모델의 일부는 전문 지식을 포착하거나 전달하지 않고 복잡성을 더함. 부수적인 요소들이 CORE DOMAIN을 식별하고 이해하는 일을 방해. 
그럼에도 일반적인 그밖의 요소들은 시스템이 정상동작하고 모델을 완전히 표현하는데 중요한 역할을 한다.

> 현재 진행중인 프로젝트를 위한 것이 아니라 응집력 있는 하위 도메인을 식별하라. 이러한 하위 도메인에서 일반적인 모델 요소를 추출해서 별도 MODULE에 배치하라. 일단 분리되면, CORE DOMAIN 보다는 낮은 우선순위를 부여. 이런 GENERIC SUBDOMAIN은 기성 솔루션이나 공표된 모델을 고려해보라.

- 기성 솔루션 : 구현된 제품을 구입하거나 오픈소스를 이용
- 공표된 설계나 모델 : 코드화 되지 않은 설계나 모델을 이용
- 외주제작된 구현 : 외주로 제작하여 구현된 것을 이용
- 사내 구현 : 직접 구현

### 일반화가 재사용이 가능하다는 의미는 아니다
디스틸레이션의 기본적인 동기에서 본다면 코드의 재사용에 신경써서는 안된다. CORE DOMAIN에 가능한한 많은 노력을 기울이고 보조적인 성격의 GENERIC SUBDOMAIN에는 필요한 만큼만 투자하자.

> 재사용을 목표로 설계할 일은 거의 없더라도 일반 개념의 범위 내에서 설계를 유지하는 것과 관련해서는 엄격해야 한다.

### 프로젝트 위험 관리
애자일에서는 가장 위험스러운 업무를 먼저 다루는 식으로 위험을 관리한다.

> 팀원들이 검증된 기술을 보유하고 도메인에 매우 친숙한 경우를 제외하면 최초로 만들어진 시스템은 CORE DOMAIN의 특정 부분에 기반을 둬야하고 단순해아 한다.

## DOMAIN VISION STATEMENT(도메인 비전 선언문)
개발이 후반부에 이르면 모델을 심층적으로 연구하지 않아도 되는 시스템의 가치를 설명할 필요가 생긴다. 

> CORE DOMAIN을 짧게 기술하고 그것의 가치를 작성할 것. 이 도메인 모델과 다른 것을 구별하는데 도움되지 않은 측면은 무시하라. 도메인 모델이 어떻게 다양한 관심사를 충족하고 균형을 이루는지 볼것. 한정된 범위에서 유지할 것. 새로운 통찰력을 얻ㄷ을때 마다 선언문을 개정할 것

코드 자체의 디스틸레이션 과정에서 개발팀을 줄곧 공통적인 방향으로 향하게 할 이정표로 사용될 수 있다.(기술적인 부분이 제외된 문서이므로, 관리조직, 비기술팀원, 고객과도 공유 가능)


