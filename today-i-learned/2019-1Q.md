# 03/21
## [The Software Craftsman 6장 정리](https://github.com/eceris/study/blob/master/the-software-craftsman/the-software-craftsman.md#6-동작하는-소프트웨어)

# 03/25
## Spring AOP의 [Proxy mechanisms](https://docs.spring.io/spring/docs/5.0.0.RELEASE/spring-framework-reference/core.html#aop-proxying) 에 대해 간단히 알아봄

SpringBoot 1.5.3 에서 Aop 를 사용하기 위해 @EnableAspectJAutoProxy(proxyTargetClass = true) 로 해주어야 하는가? 에 대한 질문에서 시작.

- Spring의 aop 구현방식은 다이나믹 프록시 방식.
- 스프링은 기본적으로 비지니스 로직에 접근할 때, 프록시 객체를 통해 간접적으로 접근.
	- 인터페이스를 구현하고 있으면 Jdk Dynamic Proxy : 인터페이스로 구현해서 정의되어있지 않는 메서드는 aop 적용안됨.
	- 인터페이스를 구현하지 않고있으면 CGLIB : 대상 클래스를 상속
- 근데, 이제는 SpringBoot에서 기본으로 CGLIB 를 사용함. 왜? 스프링 개발자가 [We've generally found cglib proxies less likely to cause unexpected cast exceptions.](https://github.com/spring-projects/spring-boot/issues/8434#issuecomment-283120308) 라고 함. 그리고 코드에서도 보면 proxy 객체의 클래스가 아래와 같이 나타남.

```
com.sun.proxy.$Proxy122 // Jdk Dynamic Proxy
com.kakaobank.ketchup.config.RedisConfig$$EnhancerBySpringCGLIB$$7f0bcba3 // Spring CGLIB
```

그래서, SpringBoot 에서 `Aop` 를 사용하려면 @EnableAspectJAutoProxy 를 무조건 달아야되?
아니 spring boot 1.5.1 이후 부터는 [AopAutoConfiguration.java](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/aop/AopAutoConfiguration.java) 가 알아서 해줌. 
결론은 1.5.1 버전 이상을 사용하면 @EnableAspectJAutoProxy 를 명시하지 않아도 되고, proxyTargetClass 는 기본 true(CGLIB를 사용)로 된다.